<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple DNS Lookup Tool</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
            background-color: #f4f4f4;
        }
        h1 {
            text-align: center;
            color: #333;
        }
        p.intro, p.note {
            color: #555;
            font-size: 14px;
            margin-bottom: 20px;
        }
        .input-container {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        #domain {
            flex-grow: 1;
            padding: 10px;
            font-size: 16px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        button {
            padding: 10px 20px;
            font-size: 16px;
            background-color: #28a745;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        button:hover {
            background-color: #218838;
        }
        .copy-btn {
            padding: 5px 10px;
            font-size: 14px;
            background-color: #007bff;
            margin-left: 10px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .copy-btn:hover {
            background-color: #0056b3;
        }
        #export-btn {
            background-color: #ff9500;
            margin-top: 10px;
            display: none;
        }
        #export-btn:hover {
            background-color: #e68a00;
        }
        #results {
            margin-top: 20px;
            padding: 15px;
            background-color: white;
            border-radius: 4px;
            border: 1px solid #ddd;
            min-height: 100px;
        }
        .loading {
            display: none;
            text-align: center;
            font-style: italic;
            color: #666;
        }
        .error {
            color: red;
        }
        .record-type {
            margin-top: 20px;
            padding: 10px;
            background-color: #e9ecef;
            border-radius: 4px;
        }
        .record-type h3 {
            margin: 0 0 10px 0;
            color: #333;
            cursor: help;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .record {
            margin: 10px 0;
            padding: 10px;
            border-left: 3px solid #28a745;
            background-color: #f8f9fa;
        }
        .data-container {
            display: flex;
            align-items: center;
        }
        .ui-tooltip {
            max-width: 300px;
            font-size: 12px;
            background-color: #333;
            color: white;
            border: 1px solid #555;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
            padding: 8px;
        }
        .fa-spin {
            animation: fa-spin 2s infinite linear;
        }
    </style>
</head>
<body>
    <h1><i class="fas fa-globe"></i> Simple DNS Lookup Tool</h1>
    <p class="intro">Enter a domain name (e.g., example.com) to view its DNS records, including IP addresses, mail servers, name servers, and more. Hover over record type headings for explanations.</p>
    <p class="note">Note: For the "Copy" buttons to work reliably, run this tool on a local server (e.g., <code>http://localhost</code>) or an HTTPS website.</p>
    <div class="input-container">
        <input type="text" id="domain" placeholder="Enter domain (e.g., example.com)">
        <button onclick="performLookup()"><i class="fas fa-search"></i> Lookup</button>
    </div>
    <div id="loading" class="loading"><i class="fas fa-spinner fa-spin"></i> Loading...</div>
    <button id="export-btn" onclick="exportRecords()"><i class="fas fa-download"></i> Export DNS Records</button>
    <div id="results"></div>

    <script>
        // Initialize jQuery UI tooltips
        $(document).ready(function() {
            $(document).tooltip({
                items: "[data-tooltip]",
                content: function() {
                    const recordType = $(this).attr('data-tooltip');
                    const tooltips = {
                        'A': 'A (Address) records map a domain to an IPv4 address (e.g., 192.0.2.1). They are used to locate the server hosting a website or service.',
                        'AAAA': 'AAAA (IPv6 Address) records map a domain to an IPv6 address (e.g., 2001:db8::1). They are used for newer, larger IP address formats.',
                        'CNAME': 'CNAME (Canonical Name) records alias one domain to another. They point to another domain name rather than an IP address (e.g., www.example.com to example.com).',
                        'MX': 'MX (Mail Exchange) records specify the mail servers responsible for receiving email for a domain (e.g., mail.example.com). They include a priority value.',
                        'NS': 'NS (Name Server) records indicate which name servers are authoritative for a domain. They list the servers managing the domainâ€™s DNS records.',
                        'TXT': 'TXT (Text) records store arbitrary text data, often used for verification (e.g., SPF, DKIM) or configuration settings for services.'
                    };
                    return tooltips[recordType] || 'No description available.';
                }
            });
        });

        let dnsRecords = {}; // Store DNS records for export

        function performLookup() {
            const domain = $('#domain').val().trim();
            const resultsDiv = $('#results');
            const loadingDiv = $('#loading');
            const exportBtn = $('#export-btn');
            const recordTypes = ['A', 'AAAA', 'CNAME', 'MX', 'NS', 'TXT'].sort(); // Sort alphabetically

            // Clear previous results and hide export button
            resultsDiv.empty();
            exportBtn.hide();
            dnsRecords = {}; // Reset records
            loadingDiv.show();

            // Input validation
            if (!domain) {
                resultsDiv.html('<p class="error"><i class="fas fa-exclamation-circle"></i> Please enter a valid domain name.</p>');
                loadingDiv.hide();
                return;
            }

            // Track completed requests
            let completedRequests = 0;
            const totalRequests = recordTypes.length;

            // Function to check if all requests are done
            function checkAllDone() {
                completedRequests++;
                if (completedRequests === totalRequests) {
                    loadingDiv.hide();
                    if (resultsDiv.is(':empty')) {
                        resultsDiv.html('<p><i class="fas fa-info-circle"></i> No records found for this query.</p>');
                    } else {
                        exportBtn.show(); // Show export button if results exist
                    }
                }
            }

            // Query each record type
            recordTypes.forEach(recordType => {
                const url = `https://dns.google/resolve?name=${encodeURIComponent(domain)}&type=${recordType}`;
                const iconMap = {
                    'A': 'fa-server',
                    'AAAA': 'fa-network-wired',
                    'CNAME': 'fa-link',
                    'MX': 'fa-envelope',
                    'NS': 'fa-sitemap',
                    'TXT': 'fa-file-alt'
                };

                $.ajax({
                    url: url,
                    method: 'GET',
                    dataType: 'json',
                    success: function(data) {
                        if (data.Answer) {
                            dnsRecords[recordType] = data.Answer; // Store records for export
                            resultsDiv.append(
                                `<div class="record-type">
                                    <h3 data-tooltip="${recordType}"><i class="fas ${iconMap[recordType]}"></i> ${recordType} Records</h3>
                                    ${data.Answer.map((answer, index) => `
                                        <div class="record">
                                            <strong>Name:</strong> ${answer.name}<br>
                                            <strong>Type:</strong> ${answer.type}<br>
                                            <strong>TTL:</strong> ${answer.TTL}<br>
                                            <div class="data-container">
                                                <strong>Data:</strong> <span id="data-${recordType}-${index}">${answer.data}</span>
                                                <button class="copy-btn" onclick="copyToClipboard('data-${recordType}-${index}')"><i class="fas fa-copy"></i> Copy</button>
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>`
                            );
                        }
                        checkAllDone();
                    },
                    error: function() {
                        checkAllDone();
                    }
                });
            });
        }

        // Export DNS records as JSON
        function exportRecords() {
            const domain = $('#domain').val().trim();
            const exportData = {
                domain: domain,
                timestamp: new Date().toISOString(),
                records: dnsRecords
            };
            const jsonString = JSON.stringify(exportData, null, 2);
            const blob = new Blob([jsonString], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${domain}_dns_records.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // Copy to clipboard function with fallback
        function copyToClipboard(elementId) {
            const text = document.getElementById(elementId).textContent;

            // Try using Clipboard API first
            if (navigator.clipboard && window.isSecureContext) {
                navigator.clipboard.writeText(text).then(() => {
                    alert('Copied to clipboard: ' + text);
                }).catch(err => {
                    console.error('Clipboard API failed: ', err);
                    fallbackCopyToClipboard(text);
                });
            } else {
                // Fallback for non-secure contexts or unsupported browsers
                fallbackCopyToClipboard(text);
            }
        }

        // Fallback copy function using textarea
        function fallbackCopyToClipboard(text) {
            try {
                const textarea = document.createElement('textarea');
                textarea.value = text;
                textarea.style.position = 'fixed'; // Prevent scrolling
                textarea.style.opacity = '0'; // Make invisible
                document.body.appendChild(textarea);
                textarea.focus();
                textarea.select();
                document.execCommand('copy');
                document.body.removeChild(textarea);
                alert('Copied to clipboard: ' + text);
            } catch (err) {
                console.error('Fallback copy failed: ', err);
                alert('Failed to copy. Try running this tool on a local server (e.g., http://localhost) or an HTTPS website.');
            }
        }

        // Trigger lookup on Enter key press
        $('#domain').on('keypress', function(e) {
            if (e.which === 13) {
                performLookup();
            }
        });
    </script>
</body>
</html>
